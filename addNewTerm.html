<!DOCTYPE html>
<html lang="en">

<script>
    //////////////////////////////////////////////////////////////////////////////////////////
    // IN ORDER TO HOST YOUR COMMUNITY IN YOUR OWN SPACE, EDIT THE VARIABLES BELOW
    var contextLink = "https://raw.githubusercontent.com/NIDM-Terms/terms/master/context/cde_context.jsonld" //Link to context file
    var communityLink = 'https://raw.githubusercontent.com/NIDM-Terms/nidm-terms.github.io/master/availableCommunities.json' //Link to list of available communities JSON dictionary found in the UI repository
    var orgRepo = 'NIDM-Terms' //If you cloned the repository (which contains one repository for the terms and another repository for the UI) to your organization, this is the name of the organization's GitHub repository. If you cloned the repository to your personal GitHub account, this is the name of your personal GitHub repository.
    var termsRepo = 'terms'; //Name of GitHub repository that contains terms - this variable can be changed if you decide to change the name of terms repository
    var pullsLink = 'https://github.com/NIDM-Terms/terms/pulls' //Link to view pull requests in the GitHub terms repository
    var issueLink = 'https://github.com/NIDM-Terms/terms/issues' //Link to view reported issues in the GitHub terms repository
    //////////////////////////////////////////////////////////////////////////////////////////
</script>

    <head>

        <title>NIDM-Terms: Suggest Terms</title>

        <script src= "https://code.jquery.com/jquery-3.5.1.js"></script> 
        <script src="./js_lib/jquery.treeView.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jsonld@1.0.0/dist/jsonld.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    </head>


    <body>

        <header>
            <div class="about">
                <form action = "https://github.com/NIDM-Terms/terms" target="_blank">
                    <button class= "github">Github <i class="fa fa-github" style="font-size:17px"></i>
                    </button>
                </form>
                <form action = "https://scicrunch.org/nidm-terms/about/project" target="_blank">
                    <button class= "website">NIDM Website</button>
                </form>
                <form action = "http://nidm.nidash.org/" target="_blank">
                    <button class = "nidmSpecs"> NIDM Specs</button>
                </form>
                <form action ="https://github.com/incf-nidash/PyNIDM" target= "_blank" >
                    <button class= "pyNidm"> PyNIDM</a>
                </form>
                <form action ="https://incf-nidash.github.io/nidmterms-ui/#/annotate" target= "_blank" >
                    <button class= "annoTool"> CSV Annotation Tool</a>
                </form>
            </div>
    
            <div class="logo-items">
                <div class= "logo">
                    <img src="img/nidm-terms_576163.png" width= "70" height="70">
                </div>
                <div class="inner">
                    <h>NIDM-Terms</h>
                </div>
            </div>
        </header>
    
        <div>
            <nav style="margin-top:175px;">
                <ul class= "menuUl"><center>
    
                    <li class= "menuLi">
                        <form action= "index.html">
                            <button class = "browse_terms" type="submit">Browse Terms</button>
                        </form>
                    </li>
                
                    <li class= "menuLi">
                        <form action= "addNewTerm.html">
                            <button class = "add_terms" type="submit">Suggest Terms</button>
                        </form>
                    </li>
    
                    <li class= "menuLi">
                        <form action="createTable.html">
                            <button class = "createTable">Export Terms</button>
                        </form>
                    </li>

                    <li class= "menuLi">
                        <form action= "addCommunity.html">
                            <button class = "add_community" type="submit">Add New Community</button>
                        </form>
                    </li>
    
                    <li class= "menuLi">
                        <form action="info.html">
                            <button class = "resources">About</button>
                        </form> 
                    </li>
    
                    <center><hr id="menuLine"></center>
    
                </center></ul>
    
            </nav>
        </div>

        <center><div class="container">

            <div id = "rmv">

                <h2 id="stepTitles">GitHub Access Token<hr style="margin-top: 5px;"></h2>


                <div class="headerBrdr"><center>
                    The NIDM-Terms effort is focused on developing and adopting a set of community driven controlled vocabulary 
                    for neuroimaging. NIDM-Terms infrastructure consists of a GitHub repository containing JSON-LD formatted 
                    files for each term. Newly added terms will be sent as a pull request to our GitHub repository.
                    Therefore, in order to suggest a new term, a GitHub API Token must be provided. 
                </center></div>

                <br>

                <div class="keyInfo"><center>
                    For more information on GitHub personal access tokens click <a href= "https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token" target="_blank"> here</a>.
                </center></div>

                <br><br><br>

                <form><input id = "token" type="password"  placeholder="Enter GitHub Personal Access Token" required></form>

                <form action="https://github.com/settings/tokens" target= "_blank">
                    <input class= "btn4" type = "submit" value="Generate GitHub Token">
                </form>


                <br><br><br><br><br>
                
                <h2 id="stepTitles">Communities<hr style="margin-top: 5px;"></h2>


                <div class="headerBrdr"><center>
                    
                </center></div>

                <center>
                    <div id="selectCommunity">
                        <table id="table"></table>
                    </div>
                </center>

                <br><br><br>

                <h2 id="stepTitles">New Term Information <hr style="margin-top: 5px;"></h2>


                <form class="inputs">
                    
                    <h4 style="margin-bottom: 10px; margin-left: -5px;">Label *
                        <div class="tool-tip">
                            <i class="tool-tip__icon">i</i>
                            <p class="tool-tip__info">
                              <span class="info"> Label for the term in camelCase.</span>
                            </p>
                        </div>
                    </h4> 
                    <input id= "label" class="newComInput" type="text" name="label" placeholder = "REQUIRED: Term in camelCase (e.g. durationTime, author)" required>
                    
                    <h4 style="margin-bottom: 10px; margin-left: -5px;">Description *
                        <div class="tool-tip">
                            <i class="tool-tip__icon">i</i>
                            <p class="tool-tip__info">
                              <span class="info"> An explanation of the nature, scope, or meaning of the new term.</span>
                            </p>
                        </div>
                    </h4>
                    <input id= "des" class="newComInput" type="text" name="description" placeholder = "REQUIRED: Term description" required>
                
                    <h4 style="margin-bottom: 10px; margin-left: -5px;">Comment
                        <div class="tool-tip">
                            <i class="tool-tip__icon">i</i>
                            <p class="tool-tip__info">
                              <span class="info"> Additional information about the term.</span>
                            </p>
                        </div>
                    </h4>
                    <input id= "comment" class="newComInput" type="text" name="comment" placeholder = "OPTIONAL: Additional comments">
                
                    <h4 style="margin-bottom: 10px; margin-left: -5px;">URL
                        <div class="tool-tip">
                            <i class="tool-tip__icon">i</i>
                            <p class="tool-tip__info">
                              <span class="info"> If exists, URL associated with the term.</span>
                            </p>
                        </div>
                    </h4>
                    <input id="url" class="newComInput" type="text" name="url" placeholder = "OPTIONAL: Term URL">

                    <h4 style="margin-bottom: 10px; margin-left: -5px;">Unit
                        <div class="tool-tip">
                            <i class="tool-tip__icon">i</i>
                            <p class="tool-tip__info">
                              <span class="info"> The term's value of measurement (e.g. years, months, grams, kilograms).</span>
                            </p>
                        </div>
                    </h4>
                    <input id="unit" class="newComInput" type="text" name="unit" placeholder = "OPTIONAL: Term unit">

                    
                    <label><h4>Value Type
                        <div class="tool-tip">
                            <i class="tool-tip__icon">i</i>
                            <p class="tool-tip__info">
                              <span class="info"> A value representation such as integer, float, string, date/time.</span>
                            </p>
                        </div>
                    </h4></label>

                        <select name="valueType" id="VT" class="VT">
                            <option value="select">--select--</option>
                            <option value="string">string</option>
                            <option value="boolean">boolean</option>
                            <option value="integer">integer</option>
                            <option value="float">float</option>
                            <option value="double">double</option>
                            <option value="duration">duration</option>
                            <option value="dateTime">dateTime</option>
                            <option value="time">time</option>
                            <option value="date">date</option>
                            <option value="anyURI">anyURI</option>
                            <option value="complexType">complexType</option>
                        </select>

                    
                    <h4>OPTIONAL: categorical variables
                        <div class="tool-tip">
                            <i class="tool-tip__icon">i</i>
                            <p class="tool-tip__info">
                              <span class="info"> 
                                This field corresponds to the BIDS "levels" standard for categorical variables where you're mapping the value (often an integer) to some text string.
                                <br><br>
                                For example the choices of the term handedness would be: 
                                <br>
                                name => right, value => 1<br>
                                name => Left, value => 2<br>
                                name => Ambidextrious, value => 10<br>
                              </span>
                            </p>
                        </div>
                    </h4>

                            

                    <form>
                        <input id="numOfValues" class="numOfValues" type="text" placeholder="Enter the number of choices">
                        <button type = "button" class= "btn3" id = "catValue"> Add Choices </button>
                    </form>

                    <div id= "addParent">
                        <div id= "add"></div>
                    </div>


                    

                    <br><br><br><br>

                    <div><button id = "pullRequest" class= "btn1" type = "button"> Send Pull Request </button></div>
                    <div id = "loader" class="loader"> </div>
                    <div id = "grayScreen" class="grayScreen"></div>
                    <div id = "loadingText" class="loadingText">Processing Pull Request...</div>
                    
                    <br>


                </form>


                <div id="PR"></div>

            </div>

                <script type = "module">
                    //display the loading screen
                    function addLoading(){
                        document.getElementById("loader").style.display = "flex";
                        document.getElementById("grayScreen").style.display = "block";
                        document.getElementById("loadingText").style.display = "flex";
                    }

                    //remove the loading screen
                    function removeLoading(){
                        document.getElementById("loader").style.display = "none";
                        document.getElementById("grayScreen").style.display = "none";
                        document.getElementById("loadingText").style.display = "none";  
                    }
                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    //add checkmarks with available community names by fetching communityLink
                    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                    $(document).ready(function(event){
                        //Fetch communityLink to get a list of the available communities in the repository
                        fetch(communityLink)
                        .then(function(res){
                            return res.json(); 
                        })

                        //Create chackboxes with the available communities and create a list of their URLS and pass it
                        .then(function(avCom){

                            var html = '';

                            var tbl = document.getElementById("table")
                            var body = document.body
                            var elementNum = 0      // keeps track of how many elements are in a row, goes to a new row after certain # of elements
                            for (const [key,value] of Object.entries(avCom)){
                                // go to a new row after filling every four columns
                                if(elementNum%4===0)
                                {
                                    html += '</tr>'
                                    html += '<tr>'
                                }
                                
                                html += '<td>'

                                // add checkboxes
                                html += '<label class="con">'+key;
                                html += '<input id="community" type="radio" name="radio" value = "'+value['label']+'">';
                                html += '<div class="des-tool-tip-text">'+value['Description']+'</div>'
                                html += '<span class="checkmark"></span>';
                                html += '</label>';
                                
                                html += '</td>'

                                elementNum++
                            }

                            $("#table").append(html);

                        })
                    })

                    ////////////////////////////////////////////////////////////////////////////////////
                    //validat that label and description have values and that terms do not already exist
                    ////////////////////////////////////////////////////////////////////////////////////
                    function nextStep(){
                       
                        //if label and description don't have values call the validation fonction
                        if (document.getElementById('token').value.length == 0){

                            document.getElementById('token').style.borderColor = 'red'
                            document.getElementById('token').style.borderWidth = '1px'
                            document.getElementById('token').style.backgroundColor = '#FFF1F1'
                            $('#token').focus();

                        }
                        else if (document.getElementById('label').value.length == 0){

                            document.getElementById('label').style.borderColor = 'red'
                            document.getElementById('label').style.borderWidth = '1px'
                            document.getElementById('label').style.backgroundColor = '#FFF1F1'
                            $('#label').focus();
                        }
                        else if (document.getElementById('des').value.length == 0){

                            document.getElementById('des').style.borderColor = 'red'
                            document.getElementById('des').style.borderWidth = '1px'
                            document.getElementById('des').style.backgroundColor = '#FFF1F1'
                            $('#des').focus();
                        }
                        //else next step, which is an iput for the github API and a button 
                        else {
                            submitTerm()
                        }

                        //submitTerm()
                        
                    }

                    document.getElementById("pullRequest").addEventListener("click", nextStep)


                    ///////////////////////////////////////////////////////////////////////////
                    /// function created to add choices if the term is a categorical variable
                    ///////////////////////////////////////////////////////////////////////////
                    var list = [];
                    function addOptions(){

                        var html = '';

                        html += '<div id="wrapper">';

                        var numOfOptions = document.getElementById('numOfValues').value;

                        list.push(numOfOptions)

                        if(document.getElementById('numOfValues').value != 0 & list.length == 1){

                            for (var i = 1; i <= numOfOptions; i++){

                                html += '<h5>Choice '+i+':</h5>';
                                html += '<input id="n'+i+'" id="name" class="newInput" type="text" name="name" placeholder = "Name">';
                                html += '<input id="v'+i+'" id="value" class="newInput" type="text" name="value" placeholder = "Value">';
                                html += '<br>';
                                    
                            }

                            html += '</div>';
                            $('#add').append(html);
                        } 
                        
                        if (document.getElementById('numOfValues').value != 0 & list.length > 1){

                            $("#add").html("");

                            for (var i = 1; i <= numOfOptions; i++){

                                html += '<h5>Choice '+i+':</h5>';
                                html += '<input id="n'+i+'" id="name" class="newInput" type="text" name="name" placeholder = "Name">';
                                html += '<input id="v'+i+'" id="value" class="newInput" type="text" name="value" placeholder = "Value">';
                                html += '<br>';

                            }

                            html += '</div>';
                            $('#add').append(html);

                        }
                        if (document.getElementById('numOfValues').value == 0){
                            html += '</div>';
                            $("#add").html("");
                        }
                    };

                    document.getElementById("catValue").addEventListener("click", addOptions)

                    function submitTerm(){

                        if(document.querySelector('input[name="radio"]:checked') == null){
                            document.getElementById('selectCommunity').style.borderColor = 'red'
                            document.getElementById('selectCommunity').style.borderWidth = '1px'
                            document.getElementById('selectCommunity').style.backgroundColor = '#FFF1F1'
                            $('#selectCommunity').focus();
                        }
                        else{
                        
                            var community = document.querySelector('input[name="radio"]:checked').value;

                            //empty dicttionary 
                            var dict = {};
                            var responseOption = {};

                            // varable to assoctae with every term based on the user's selection
                            if(community.startsWith("NIDM")){
                                var associatedWith = "NIDM";
                            }
                            else{
                                //Slice the last 6 characters "_Terms" to get the name of the community
                                var com = community.substring(0, community.length - 6)
                                var associatedWith = [com, "NIDM"];
                                console.log(associatedWith)
                            }

                            $(document).ready(function(event) { 
                                // fetch the context file and create a jsonld
                                fetch(contextLink)
                                .then(function(resp){
                                    return resp.json(); 
                                })

                                .then(async function(context){

                                    dict['@context'] = contextLink

                                    //call checkTerm to checkif the lable of the term already exists to avoid duplication
                                    //returns 1 if the terms exists and 0 if the term doesn't exist
                                    //var check = checkLabel(document.getElementById("label").value)
                                    //console.log(checkLabel(document.getElementById("label").value))

                                    
                                    //assign inputted values to term properties
                                    dict[context["@context"]["label"]] = document.getElementById("label").value;
                                    dict['@type'] = context["@context"]["PersonalDataElement"]
                                    if(document.getElementById("des").value.length != 0){
                                        dict[context["@context"]["description"]] = document.getElementById("des").value;
                                    }
                                    if(document.getElementById("comment").value.length != 0){
                                        dict[context["@context"]["comment"]] = document.getElementById("comment").value;
                                    }
                                    if(document.getElementById("url").value.length != 0){
                                        dict[context["@context"]["url"]["@id"]] = document.getElementById("url").value;
                                    }
                                    if(document.getElementById("unit").value.length != 0){
                                        responseOption[context["@context"]["unitCode"]] = document.getElementById("unit").value;
                                    }
                                    if(document.getElementById("VT").value.length != 0 & document.getElementById("VT").value != 'select'){
                                        responseOption[context["@context"]["valueType"]] = document.getElementById("VT").value;
                                    }
                                    if(document.getElementById('numOfValues').value.length != 0){
                                        //empty list for choices dictionaries
                                        var choices_list = [];
                                    
                                        //get the number of choices available
                                        var valNum = document.getElementById('numOfValues').value;
                                        //loop through the choices and add them to add to the jsonld
                                        for (var l = 1; l <= valNum; l++){
                                            console.log(l)

                                            // empty dictionary for each choice's name and value
                                            var choices = {};

                                            if(document.getElementById("n"+l).value.length != 0 & document.getElementById("v"+l).value.length != 0){
                                                choices[context['@context']['name']] = document.getElementById("n"+l).value;
                                                choices[context['@context']['value']] = document.getElementById("v"+l).value;
                                                choices_list.push(choices)
                                            }
                                        }

                                        //assign choices to responseOptions dictionary
                                        if(choices_list.length != 0){
                                            responseOption[context['@context']['choices']] = choices_list;
                                        }

                                    }    

                                    //add response options values
                                    if(Object.keys(responseOption).length != 0){
                                        dict[context["@context"]["responseOptions"]["@id"]] = responseOption
                                    }
                                    //always associate the term with the appropriate community
                                    dict[context["@context"]["associatedWith"]] = associatedWith;


                                    //compact term dictionary
                                    const compacted = await jsonld.compact(dict, contextLink);
                                    console.log(compacted)

                                    return compacted
                                        
                                })

                                .then(function(newTermJsonld){
                                    //document.getElementById("pullRequest").addEventListener("click", function(){ sendPR(newTermJsonld, community); })
                                    sendPR(newTermJsonld, community)
                                })
                                

                            });
                        };

                    };


                    import { Octokit } from "https://cdn.pika.dev/@octokit/core";


                    //////////////////////////////////////////////////////////////////////////////////
                    /// function created to create jsonld files and submit a pull request to github
                    //////////////////////////////////////////////////////////////////////////////////

                    function sendPR (newTermJsonld, community){
                        //Get GitHub API key
                        if(document.getElementById("token").value.length == 0){
                            removeLoading()
                            alert('A GitHub API Token is required to complete the pull request')
                            document.getElementById("token").style.borderWidth = '1px';
                            document.getElementById("token").style.borderColor = 'red';
                            document.getElementById("token").style.backgroundColor = '#FFF1F1';
                        } 
                        else {
                            addLoading()

                            const gitToken = document.getElementById("token").value;

                            const octokit = new Octokit({ auth: gitToken });
                            // const info = octokit.request(`GET /user`);
                            // console.log(info)

                            const repo = termsRepo;
                            const fileName = document.getElementById("label").value;
                            
                            //GET user's github username
                            octokit.request(
                                `GET /user`
                            ).then((response) => {
                                console.log(20, response)
                                //call fork repo to check if the user has the repo forked
                                //if repo is not found then fork it
                                forkRepo(response.data.login)
                            }).catch((e) => {
                                console.log(23, e.message);
                                removeLoading()
                                alert('Bad Credentials... Please Enter A Valid Personal Access Token.')
                            })

                            //fork repo function
                            async function forkRepo(owner){
                                octokit.request(
                                    `GET /repos/{owner}/{repo}`, {
                                        headers: {
                                            'User-Agent': termsRepo,
                                            'accept': 'application/json'
                                        },
                                        owner: owner,
                                        repo: repo
                                    }).then((res) => {
                                    console.log(47, 'success', owner, repo, newTermJsonld); // repo exists!
                                    //call function to get the master branch sha
                                    getSha(owner)
                                }).catch((e) => {
                                    console.log(50, e.message);
                                    if (e.message === "Not Found") { // repo not present, so fork the repo
                                        // fork the repo
                                        octokit.request(
                                            `POST /repos/{owner}/{repo}/forks`, {
                                                headers: {
                                                    'Authorization': 'token ' + gitToken,
                                                },
                                                owner: orgRepo,
                                                repo: repo
                                            }).then((response) => {
                                            console.log(71, 'successfully forked: ', response.status);
                                            if (response.status === 200 || response.status=== 201) {
                                                //call function to get the master branch sha
                                                getSha(owner)
                                            } else if (response.status === 202) {
                                                setTimeout(getSha, 3000, owner);
                                            }
                                            console.log(77, "post fork: ", response);
                                        }).catch((e) => {
                                            console.log(79, e.message);
                                            reportAnIssue('NIDM Terms UI: an issue with forking '+orgRepo+' repo', e);
                                        });
                                    }
                                });

                                //function to get sha hash of master branch
                                async function getSha(user){
                                    octokit.request(`GET /repos/{owner}/{repo}/branches/{branch}`, {
                                        owner: user,
                                        repo: repo,
                                        branch: 'master'
                                    }).then((r) => {
                                        console.log(43, 'sha is: ', r.data.commit.sha)
                                        //call function to create a branch
                                        createNewBranch(r.data.commit.sha, user)
                                    })
                                    .catch((e) => {
                                        console.log(55, e.message);
                                        reportAnIssue('NIDM Terms UI: an issue with getting master branch hash', e);
                                    })
                                };
                            }

                            //function to create a new branch with the term name
                            async function createNewBranch(sha,user){
                                octokit.request(`POST /repos/{owner}/{repo}/git/refs`, {
                                    owner: user,
                                    repo: repo,
                                    ref: 'refs/heads/'+community+'_'+fileName,
                                    sha: sha
                                }).then((response) => {
                                    console.log(72, 'successfully created a new branch: ', response.status);
                                    //call function to comit file to the new branch
                                    createFileInRepo(newTermJsonld, 'terms/'+community+'/'+fileName+'.jsonld', user);
                                }).catch((e) => {
                                    console.log(67, e.message);
                                    reportAnIssue('NIDM Terms UI: an issue with creating a new branch', e);
                                });
                            }

                            //function to commit to the new branch
                            async function createFileInRepo(jsonTermObj, pathToFile, user) {
                                console.log(57, jsonTermObj, pathToFile, user);
                                // let content = Buffer.from(JSON.stringify(jsonTermObj, undefined, 2)).toString('base64');
                                const content = btoa(JSON.stringify(jsonTermObj, undefined, 2)); // for use in browser
                                console.log(63, content);
                                octokit.request(
                                    `PUT /repos/{owner}/{repo}/contents/{path}`, {
                                        headers: {
                                            'Authorization': 'token ' + gitToken,
                                        },
                                        owner: user,
                                        repo: repo,
                                        path: pathToFile,
                                        message: 'New '+community+' Term Added: '+fileName,
                                        content: content,
                                        branch: community+'_'+fileName
                                    }).then((response) => {
                                    console.log(91, "statusCode for createFile: ", response.status);
                                    if (response.status === 200 || response.status=== 201) {
                                        //call function to raise a pull request
                                        createPullRequest(pathToFile, user);
                                    }
                                }).catch((e) => {
                                    console.log(93, e.message);
                                    reportAnIssue('NIDM Terms UI: an issue with commiting a new term', e);
                                });
                            }

                            //function to raise a pull request
                            async function createPullRequest(pathToFile, user) {
                                var st = '';
                                console.log(96, 'in createPR');
                                octokit.request(
                                    `POST /repos/{owner}/{repo}/pulls`, {
                                        headers: {
                                            'Authorization': 'token ' + gitToken,
                                        },
                                        owner: orgRepo,
                                        repo: repo,
                                        title: 'New '+community+' Term Added: ' + fileName,
                                        body: 'Edited or Added Terms:' + pathToFile,
                                        head: user + ':'+community+'_' + fileName,
                                        base: 'master'
                                    }).then(resp => {
                                    console.log(108, "StatusCode for Pull Request: ", resp.status);
                                    var st = '1';
                                    //call confimation function
                                    submission(st)
                                }).catch(e => {
                                    console.log(110, 'error in raising PR: ', e);
                                    reportAnIssue('NIDM Terms UI: an issue with sending a pull request',e);
                                })

                            } 


                            //function to display confirmation to the pull request
                            async function submission(state){
                                if(state == '1'){

                                    $('#rmv').html("")

                                    var html = '<br><br><br>';

                                    html += '<h2 id="stepTitles">Submission Complete <hr style="margin-top: 5px;"></h2>'

                                    html += '<div class="headerBrdr"><center>Thank you for adding a new term to '+orgRepo+'. ';
                                    html += 'Your term has been submitted for further discussion.<br><br></center></div>';

                                    html += '<div class="headerBrdr">';

                                    html += '<form><center>';
                                    html += '<button onClick="window.location.reload();" id = "newTerm" class= "subBtn" type = "button"> Add another term </button>';
                                    html += '</center></form>';
                                        
                                    html += '<form><center>';
                                    html += '<a target = "_blank"> <button id = "viewPR" class= "subBtn" type = "button" > View Pull Request </button></a>';
                                    html += '</center></form>';

                                    html += '<br><br>';
                                    html += '</div>';

                                    $('#rmv').append(html)

                                    document.getElementById("viewPR").addEventListener('click', function(){location.href="https://github.com/"+orgRepo+"/"+termsRepo+"/pulls"})
                                }
                            }

                            //function to display an issue with the code and how to report it
                            async function reportAnIssue(issue, e){

                                $('#rmv').html("")

                                var html = '<br><br><br>';

                                html += '<h2 id="stepTitles">Issue with Submission <hr style="margin-top: 5px;"></h2>'

                                html += '<div class="headerBrdr"><center>Oops! Something went wrong while adding the new term.<br><br></center></div>';

                                html += '<div class="headerBrdr">';

                                html += '<form><center>';
                                html += '<button id = "report" class= "subBtn" type = "button" > Report </button>';
                                html += '</center></form>';

                                html += '<br><br>';
                                html += '</div>';

                                $('#rmv').append(html);

                                document.getElementById("report").addEventListener("click", function(){ createGithubIssue(issue); })
   
                            }

                            async function createGithubIssue(issue, e){
                                octokit.request(`POST /repos/{owner}/{repo}/issues`, {
                                owner: orgRepo,
                                repo: termsRepo,
                                title: issue,
                                body: 'An issue occurred while submitting a new term: '+JSON.stringify(newTermJsonld) +  '\n' + e 
                                }).then(l => {
                                    console.log('issue was posted')
                                    issueConfirm()
                                }).catch(e => {
                                    console.log(59, 'error in posting an issue: ', e);
                                });
                            }

                            async function issueConfirm(){
                                $('#rmv').html("")

                                var html = '<br><br><br>';
                                
                                html += '<h2 id="stepTitles">Issue Reported <hr style="margin-top: 5px;"></h2>'

                                html += '<div class="headerBrdr"><center>Thank you for reporting! ';
                                html += 'A GitHub issue in the '+orgRepo+' repository reporting the problem was created on your behalf.<br><br></center></div>';

                                html += '<div class="headerBrdr">';

                                html += '<form><center>';
                                html += '<a target = "_blank"> <button id = "viewIssue" class= "subBtn" type = "button" > View GitHub Issue </button></a>';
                                html += '</center></form>';

                                html += '<br>';
                                html += '</div>';

                                $('#rmv').append(html);

                                document.getElementById("viewIssue").addEventListener('click', function(){location.href="https://github.com/"+orgRepo+"/"+termsRepo+"/issues"})
                            }

                        }
                    }


                </script>
                

        </div></center>


    </body>

    <footer>
        <div id="footer">
            <hr id= "bottomLine">
            <p><center>This project was supported by the National Institutes of Mental Health (NIMH) grant 1RF1MH120021</center></p>
        <div>
    </footer>

    <style>
        header{
            overflow:hidden;
            position:fixed;
            top:0;
            width:100%;
            z-index:2;
        }
    
        .about{
            color: #52575e;
            background-color: white;
            height: 45px;
            width:100%;
            font-size: 12px;
            cursor: pointer;
            outline: none;
            font-weight: lighter;
        }

        .github{
            float: right;
            margin-right: -10px;
            color: #646464;
            font-size: 13px;
            width: 130px;
            height:50px;
            font-weight: lighter;
        }

        .github:hover{
            color: #32e17c;
            transition: 0.1s;
        }
        
        .website{
            float: right;
            margin-right: -30px;
            color:#646464;
            font-size: 13px;
            width: 130px;
            height:50px;
            font-weight: lighter;
        }

        .website:hover{
            color: #32e17c;
            transition: 0.1s;
        }

        .nidmSpecs{
            float: right;
            margin-right: -20px;
            color: #646464;
            font-size: 13px;
            width: 130px;
            height:50px;
            font-weight: lighter;
        }

        .nidmSpecs:hover{
            color: #32e17c;
            transition: 0.1s;
        }

        .pyNidm{
            float: right;
            margin-right: -30px;
            color: #646464;
            font-size: 13px;
            width: 130px;
            height:50px;
            font-weight: lighter;
        }

        .pyNidm:hover{
            color: #32e17c;
            transition: 0.1s;
        }

        .annoTool{
            float: right;
            margin-right: -20px;
            color: #646464;
            font-size: 13px;
            width: 150px;
            height:50px;
            font-weight: lighter;
        }

        .annoTool:hover{
            color: #32e17c;
            transition: 0.1s;
        }

        .inner{
            margin-top:-60px;
            padding-left: 124px;
            font-weight:lighter;
            font-size: 40px;
            font-family: serif;
            text-transform: uppercase;
            color: white;
        }
        .logo{
            display: inline-block;
            margin-left:20px;
            margin-top:15px;
        }

        .logo-items{
            margin-top:0;
            background-color: #52575e;
            height: 100px;
            width:100%;
        }

        body {
            background-color: #ffffff;
        }

        .menuUl{
            width: auto;
            margin-top: 40px;
        }

        .menuLi{
            display: inline-block;
            padding: 20px 5px;
        }

        button{
            width: 235px;
            height: 60px;
            background-color: transparent;
            border: transparent;
            border-radius: 0px;
            font-size: 18px;
            font-weight:bold;
            cursor: pointer;
            outline: none;
        }

        .browse_terms{
            color: #EA2027;    
        }
        .browse_terms:hover{
            border: 2px solid #EA2027;
            border-radius: 5px;
        }

        .add_terms{
            color: #EE5A24;
            border: 2px solid #EE5A24;
            border-radius: 5px;
        }

        .createTable{
            color: #f1842b;
        }
        .createTable:hover{
            border: 2px solid #f1842b;
            border-radius: 5px;
        }

        .add_community{
            color: #F79F1F;
        }
        .add_community:hover{
            border: 2px solid #F79F1F;
            border-radius: 5px;
        }

        .resources{
            color: #FFC312;
        }
        .resources:hover{
            border: 2px solid #FFC312;
            border-radius: 5px;

        }

        #menuLine{
            height: 10px;
            background-image: linear-gradient(
                to right, 
                #EA2027, 
                #EE5A24, 
                #F79F1F, 
                #FFC312
                );
            margin-top: -23px;
            width: 1410px;
            border: 0 none;
        }

        .container{
            width: 1050px;
            height: 170%;
            text-align: left;
            font-family:Arial, Helvetica, sans-serif;
            border: 1px solid #b3b3b3 ;
            border-radius: 0px;
            padding: 80px;
            padding-top: 80px;
            padding-right: -10px;
            margin-top: 50px;
            margin-bottom: 100px;
            background-color: #F7F7F7 ;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);

        }

        .headerBrdr{
            font-size: 15px;
            color: #686666;
            text-align: justify;
            text-justify: inter-word;
            padding-left: 20px;
            line-height: 26px;
            margin-left: 80px;
            margin-right: 55px; 

        }

        .keyInfo{
            font-size: 12px;
            text-indent: 4px;
            color: #686666;
            text-align: justify;
            text-justify: inter-word;
            padding-left: 10px;
            line-height: 16px; 
            font-style: italic;
        }

        .git{
            height: 45px;
            width: 40%;
            border-radius: 5px;
            border-color: #7e7e7e;
            padding: 0px 20px;
            background-color: #fdfdfd;
            font-size: 18px;
            text-indent: 20px;
            outline: none;
            font-size: 16px;
            margin-top: -25px;
            margin-bottom: 30px;
        }

        #stepTitles{
            font-size: 32px;
            color: #6e6d6d;
            font-weight: 200;
            margin-left: 5px;
            margin-right: 5px;
        }
    
        .TermInput{
            height: 45px;
            width: 90%;
            border-radius: 5px;
            border-color: #7e7e7e;
            padding: 0px 20px;
            background-color: #fdfdfd;
            font-size: 18px;
            text-indent: 20px;
            outline: none;
            font-size: 16px;
            margin-top: -25px;
            margin-bottom: 30px;
        }

        .inputs{
            padding-top: 3px;
            padding-left: 75px;
        }

        .subTermInput{
            height: 35px;
            width: 30%;
            border-radius: 5px;
            border-color: #7e7e7e;
            padding: 0px 20px;
            background-color: #fdfdfd;
            font-size: 18px;
            text-indent: 10px;
            outline: none;
            font-size: 16px;
            margin-left: 35px;
            margin-top: 5px;
            margin-bottom: 30px;            
        }

        #token{
            height: 45px;
            width: 40%;
            border-radius: 3px;
            border: 1px solid #919191;
            padding: 0px 30px;
            background-color: #fdfdfd;
            font-size: 18px;
            text-indent: 10px;
            outline: none;
            font-size: 16px;
            margin-left: 197px;
            margin-top: 5px;
            margin-bottom: 30px;

            border-top-color: #9e9e9e;
            border-right-color: #9e9e9e;
            border-left-color: #9e9e9e;
            border-bottom-color: #9e9e9e;
        }
        .newComInput{
            width: 90%;
            height: 45px;
            border-radius: 3px;
            border: 1px solid #919191;
            padding: 0px 20px;
            background-color: #fdfdfd;
            font-size: 18px;
            text-indent: 10px;
            outline: none;
            font-size: 16px;
            margin-top: 5px;
            margin-bottom: 30px;

            border-top-color: #9e9e9e;
            border-right-color: #9e9e9e;
            border-left-color: #9e9e9e;
            border-bottom-color: #9e9e9e;
        }

        .newInput{
            width: 35%;
            height: 45px;
            border-radius: 3px;
            border: 1px solid #919191;
            padding: 0px 20px;
            background-color: #fdfdfd;
            font-size: 18px;
            text-indent: 10px;
            outline: none;
            font-size: 16px;
            margin-top: 5px;
            margin-bottom: 30px;
            margin-left: 20px;

            border-top-color: #9e9e9e;
            border-right-color: #9e9e9e;
            border-left-color: #9e9e9e;
            border-bottom-color: #9e9e9e;
        }

        #CommunityDes{
            height: 150px;
            text-indent: 5px;
            padding-top: 10px;
            font-family:sans-serif;
            font-size: 16px;
        }

        #newC{
            margin-left: 80px;
        }

        .VT{
            height: 53px;
            width: 94.5%;
            border-radius: 3px;
            border-color: #9e9e9e;
            border: 1px solid #9e9e9e;
            background-color: #fdfdfd;
            font-size: 18px;
            text-indent: 20px;
            outline: none;
            font-size: 16px;
            margin-top: -25px;
            margin-bottom: 30px;
            color: #777676;
            font-size: 17px;
            
            background-color: #fdfdfd;
            min-width: 160px;
            padding: 12px 16px;
        }

        #numOfValues{
            margin-top: -20px;
            border: 1px solid #9e9e9e;
            border-radius: 3px;
            width: 72%;
            height: 50px;
            text-indent: 25px;
            font-size: 16px;
            outline: none;
        }

        #name{
            float: left;
            margin-left: 30px;
            border: 1px solid #9e9e9e;
        }

        #value{
            float:right;
            margin-left: 40px;
            border: 1px solid #9e9e9e;
        }
        

        #wrapper{
            text-indent: 0px;
            border: 1px solid #9e9e9e;
            border-radius: 3px;
            background-color: #f8f8f8;
            width: 92%;
            padding-top: 50px;
            padding-left: 50px;
            padding-bottom: 2%;
            margin-left: 74px;
            width: 82.75%;
        }

        .btn{
            margin-top: -30px;
        }

        .btn1{
            float: right;
            cursor: pointer;
            width: 200px;
            height: 50px;
            background-image: linear-gradient(
            to right, 
            #EE5A24, 
            #F79F1F
            );
            border-radius: 5px;
            font-size: 18px;
            color: #fefcfb;
        }

        .btn1:active {
            background: #e5e5e5;
            -webkit-box-shadow: inset 0px 0px 5px #96161a;
                -moz-box-shadow: inset 0px 0px 5px #96161a;
                    box-shadow: inset 0px 0px 5px #96161a;
            outline: none;

        }
        .btn1:hover{
            color:#fefcfb;
            background-image: linear-gradient(
            to right, 
            #EE5A24, 
            #F79F1F
            );
            border: none;
        }

        .btn2{
            float: left;
            cursor: pointer;
            width: 285px;
            height: 50px;
            background-color: #fefcfb;
            border: 2px solid #EE5A24;
            border-radius: 5px;
            font-size: 18px;
            color: #EE5A24;
            margin-top: -36px;
        }

        .btn2:active {
            background: #e5e5e5;
            -webkit-box-shadow: inset 0px 0px 5px #791316;
                -moz-box-shadow: inset 0px 0px 5px #791316;
                    box-shadow: inset 0px 0px 5px #791316;
            outline: none;
        }

        .btn2:hover{
            color:#fefcfb;
            background-image: linear-gradient(
            to right, 
            #EE5A24, 
            #F79F1F
            );
            border: none;
        }

        .btn3{
            float: right;
            cursor: pointer;
            width: 200px;
            height: 54px;
            background-color: #f0f0f0;
            border: 1px solid #52575e;
            border-radius: 3px;
            font-size: 16px;
            color: #727272;
            margin-top: -18px;
            margin-right: 55px;
        }
        .btn3:hover{
            border: 1px solid #47494d;
            background-color: #e2e2e2;
        }
        .btn3:active {
            background: #e5e5e5;
        }

        .btn4{
            float: right;
            cursor: pointer;
            width: 200px;
            height: 47px;
            background-image: linear-gradient(
            to right, 
            #EE5A24, 
            #F79F1F
            );
            border-radius: 3px;
            font-size: 18px;
            color: #fefcfb;
            margin-top: -77px;
            margin-right: 160px;
            outline: none;

            border-top-style: hidden;
            border-right-style: hidden;
            border-left-style: hidden;
            border-bottom-style: hidden;
        }

        .btn4:active {
            -webkit-box-shadow: inset 0px 0px 5px #96161a;
                -moz-box-shadow: inset 0px 0px 5px #96161a;
                    box-shadow: inset 0px 0px 5px #96161a;
            outline: none;

        }

        .subBtn{
            cursor: pointer;
            width: 200px;
            height: 50px;
            background-color: #fefcfb;
            border: 2px solid #EE5A24;
            border-radius: 5px;
            font-size: 15px;
            color: #EE5A24;
            margin-top: 20px;
        }

        .subBtn:active {
            background: #e5e5e5;
            -webkit-box-shadow: inset 0px 0px 5px #96161a;
                -moz-box-shadow: inset 0px 0px 5px #96161a;
                    box-shadow: inset 0px 0px 5px #96161a;
            outline: none;

        }
        .subBtn:hover{
            color:#fefcfb;
            background-image: linear-gradient(
            to right, 
            #EE5A24, 
            #F79F1F
            );
            border: none;
        }


        h4{
            color: #757575;
            font-weight:bold;
            font-size: 20px;
            text-indent: 20px;
        }

        h5{
            color: #52575e;
            font-weight:bold;
            font-size: 16px;
            text-indent: 30px; 
            display: inline;
        }

        .loader {
            align-items: center;
            position: fixed;
            display: none;
            justify-content: center;
            left: 50%;
            top: 50%;
            border-top: 8px solid #EA2027;
            border-right: 8px solid #EE5A24;
            border-bottom: 8px solid #F79F1F;
            border-left: 8px solid #FFC312;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;   
            z-index: 3;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }    

        .grayScreen{
            display: none;
            position: fixed;
            justify-content: center;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color:rgba(175, 175, 175, 0.301);
            width: 100vw;
            height: 100vh;
            outline: none;
            z-index: 2;
        }

        .loadingText{
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-35%, -120%);
            display: none;
            color: #ff4400;
            font-size: 20px;
            font-weight: bold;
            left: 50%;
            top: 50%;
        }

        #bottomLine{
            height: 3px;
            background-image: linear-gradient(
                to right, 
                #EA2027, 
                #EE5A24, 
                #F79F1F, 
                #FFC312
                );
            width: 100%;
            border: 0 none;
        }

        #footer{
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            text-align: center;
            background-color: white;
        }

        /************** Tool Tip Styles ********************************/
        .tool-tip {
            display: inline-block;
            position: absolute;
            margin-left: 0.5em;
        }
        .tool-tip .tool-tip__icon {
            border-radius: 10px;
            cursor: pointer;
            font-style: italic;
            font-family: times new roman;
            height: 18px;
            line-height: 1.3em;
            width: 18px;
            margin-left: -23px;
            margin-top: -8px;
            color: #43acdd;
        }
        .tool-tip .tool-tip__info {
            display: none;
            background: #52575e;
            border: 1px solid #52575e;
            border-radius: 3px;
            font-size: 16px;
            color: rgb(238, 238, 238);
            padding: 1em;
            position: absolute;
            left: 27px;
            top: -20px;
            width: 500px;
            z-index: 0;
            text-indent: 7px;
            font-family:sans-serif;
            font-weight: normal;
        }
        .tool-tip .tool-tip__info:before, .tool-tip .tool-tip__info:after {
            content: "";
            position: absolute;
            left: -10px;
            top: 7px;
            border-style: solid;
            border-width: 10px 10px 10px 0;
            border-color: transparent #52575e;
        }
        .tool-tip .tool-tip__info:after {
            left: -8px;
            border-right-color: #52575e;
        }
        .tool-tip .tool-tip__info .info {
            display: block;
        }
        .tool-tip .tool-tip__info .info__title {
            color: #2a2b2c;
        }
        .tool-tip:hover .tool-tip__info, .tool-tip:focus .tool-tip__info {
            display: inline-block;
        }

        a:focus + .tool-tip .tool-tip__info {
            display: inline-block;
        }
        /* pop-up display for community descriptions when hover over checkbox label */
        input + .des-tool-tip-text {
            display: none;
        }
        input:hover + .des-tool-tip-text {
            display: block;
            position: absolute;
            text-align:left;
            padding: 0.3em;
            width: 150px;
            bottom: 150%;
            font-size: 16px;
            background: #52575e81;
            color: rgb(238, 238, 238);
            border-radius: 3px;
        }
        /* the triangular point of the pop-up box */
        input:hover + .des-tool-tip-text:after {
            content: "";
            position: absolute;
            border:1px solid #52575e67;
            left: 0%;
            top: 100%;
            width: 0; 
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 10px solid #52575e67;
            border-bottom: 5px solid transparent;
        }

        .step2_tool-tip {
            display: inline-block;
            position: absolute;
            margin-left: 0.5em;
        }
        .step2_tool-tip .step2_tool-tip__icon {
            border-radius: 10px;
            cursor: pointer;
            font-style: italic;
            font-family: times new roman;
            height: 18px;
            line-height: 1.3em;
            width: 18px;
            margin-left: 90px;
            margin-top: 70px;
            color: #43acdd;
        }
        .step2_tool-tip .step2_tool-tip__info {
            display: none;
            background: #52575e;
            border: 1px solid #52575e;
            border-radius: 3px;
            font-size: 16px;
            color: rgb(238, 238, 238);
            padding: 1em;
            position: absolute;
            left: 320px;
            top: -23px;
            width: 500px;
            z-index: 0;
            text-indent: 7px;
            font-family:sans-serif;
            font-weight: normal;
        }
        .step2_tool-tip .step2_tool-tip__info:before, .step2_tool-tip .step2_tool-tip__info:after {
            content: "";
            position: absolute;
            left: -10px;
            top: 7px;
            border-style: solid;
            border-width: 10px 10px 10px 0;
            border-color: transparent #52575e;
        }
        .step2_tool-tip .step2_tool-tip__info:after {
            left: -8px;
            border-right-color: #52575e;
        }
        .step2_tool-tip .step2_tool-tip__info .info {
            display: block;
        }
        .step2_tool-tip .step2_tool-tip__info .step2_info__title {
            color: #2a2b2c;
        }
        .step2_tool-tip:hover .step2_tool-tip__info, .step2_tool-tip:focus .step2_tool-tip__info {
            display: inline-block;
        }

        a:focus + .step2_tool-tip .step2_tool-tip__info {
            display: inline-block;
        }

        /* The container */
        .con {
        display: inline-block;
        position: relative;
        padding-left: 30px;
        margin-left: 30px;
        margin-bottom: 12px;
        cursor: pointer;
        font-size: 16px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        }

        /* Hide the browser's default radio button */
        .con input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        }

        /* Create a custom radio button */
        .checkmark {
        position: absolute; 
        top: 0;
        left: 0;
        height: 20px;
        width: 20px;
        background-color: rgb(219, 219, 219);
        border-radius: 50%;
        }

        /* On mouse-over, add a grey background color */
        .con:hover input ~ .checkmark {
        background-color: #ccc;
        }

        /* When the radio button is checked, add a blue background */
        .con input:checked ~ .checkmark {
        background-color: #2196F3;
        }

        /* Create the indicator (the dot/circle - hidden when not checked) */
        .checkmark:after {
        content: "";
        position: absolute;
        display: none;
        }

        /* Show the indicator (dot/circle) when checked */
        .con input:checked ~ .checkmark:after {
        display: block;
        }

        /* Style the indicator (dot/circle) */
        .con .checkmark:after {
            top: 6px;
            left: 6px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
        }  

        #options{
            margin-top: -38px;
            color: rgb(85, 85, 85);
        }

        table{
            background-color: rgb(240, 240, 240);
            border: 10px solid rgb(240, 240, 240);
            border-collapse: collapse;
            width: 90%;
            vertical-align: middle;
            word-wrap: break-word;
            color: rgb(85, 85, 85);
        }

        td, tr {
            padding:5px; 
            text-align: left;
            vertical-align: middle;
        }

        td {
            padding: 10px;
        }

        #selectTitle{
            text-indent: 10px;
            font-weight: normal;
            color:   rgb(240, 240, 240);
            font-size: 20px;
        }

        #selectCommunity{
            border: 1px solid rgb(240, 240, 240);
            border-radius: 3px;
            background-color: rgb(240, 240, 240);
            padding-top: 15px;
            padding-bottom: 20px;
            margin-left: 60px;
            margin-right: 75px;
        }

    </style>

    

    
</html>
